=======================
procPrintOpencourseInfo
=======================
create or replace procedure procPrintOpencourseInfo(
    pTeacherNum number,
    pResult out SYS_REFCURSOR
)
is
begin
    open presult for
        select oc.num as coursenum, ac.name as coursename, oc.startdate as startdate, oc.enddate as enddate, oc.classroomnum as classroomnum from tblopencourse oc inner join tblallcourse ac on oc.allcoursenum = ac.num where oc.teachernum = pTeacherNum and oc.startdate < sysdate and sysdate < oc.enddate;
end;

=======================
procPrintEndSubjectList
=======================
create or replace procedure procPrintEndSubjectList(
    pTeachernum number,
    pResult out SYS_REFCURSOR
)
is
begin
    open presult for
    select opencoursenum, s.num as subjectnum, s.name as subjectname, pbs.startdate as startdate, pbs.enddate as enddate, b.name as bookname
    from tblperiodbysubject pbs inner join tblsubjectbycourse sbc on pbs.subjectbycoursenum = sbc.num inner join tblsubject s on sbc.subjectnum = s.num inner join tblbook b on s.num = b.subjectnum 
    where opencoursenum in (select num from tblopencourse oc where teachernum = pTeachernum and startdate < sysdate and sysdate < enddate) and sysdate > pbs.enddate;
end;

create or replace procedure procPrintEndSubjectList(
    pTeachernum number,
    pResult out SYS_REFCURSOR
)
is
begin
    open presult for
    select opencoursenum, s.num as subjectnum, s.name as subjectname, pbs.startdate as startdate, pbs.enddate as enddate, b.name as bookname
    from tblperiodbysubject pbs inner join tblsubjectbycourse sbc on pbs.subjectbycoursenum = sbc.num inner join tblsubject s on sbc.subjectnum = s.num inner join tblbook b on s.num = b.subjectnum 
    where opencoursenum in (select num from tblopencourse oc where teachernum = pTeachernum and startdate < sysdate and sysdate < enddate) and sysdate > pbs.enddate;
end;

=======================
procPrintRatioBySub
=======================
create or replace procedure procPrintRatioBySub(
    pOpencourseNum number,
    pSubjectNum number,
    pResult out SYS_REFCURSOR
)
is
begin
    open pResult for
    select e.writtentestratio as wRatio, e.performancetestratio as pRatio, e.attendanceratio as aRatio
    from tblexam e inner join tblsubjectbycourse sbc on e.subjectbycoursenum = sbc.num inner join tblsubject s on s.num = sbc.subjectnum
    where opencoursenum = pOpencourseNum and s.num = pSubjectNum;
end;

=======================
procPrintRegitScore
=======================
create or replace procedure procPrintRegitScore(
    pOpencourseNum number,
    presult out SYS_REFCURSOR
)
is
begin
    open presult for 
    select num as examnum from tblexam where opencoursenum = pOpencourseNum;
end;


=======================
procPrintEndSubjectList2
=======================
create or replace procedure procPrintEndSubjectList2(
    pOpencoursenum number,
    pResult out SYS_REFCURSOR
)
is
begin
    open presult for
    select ch.num as coursehistorynum, std.name as studentname, std.tel as tel, ch.status as status
    from tblcoursehistory ch inner join tblstudent std on ch.studentnum = std.num 
    where opencoursenum = 13;
end;

=======================
procReturnExamPK
=======================
create or replace procedure procReturnExamPK(
    pSubjectNum number,
    pOpencourseNum number,
    pExamPknum out number
)
is
begin
    select e.num into pExamPknum from tblsubjectbycourse sbc inner join tblexam e on e.subjectbycoursenum = sbc.num where subjectnum = pSubjectNum and e.opencoursenum = pOpencourseNum;
end;


=======================
procInsertScoreToScorebyExam
=======================
create or replace procedure procInsertScoreToScorebyExam(
    pcoursehistorynum number,
    pExamnum number,
    pWscore number,
    pPscore number,
    pAscore number
)
is
begin
    insert into tblscorebysubject values (SCOREBYSUBJECTSEQ.nextval, pcoursehistorynum, pExamnum, pWscore, pPscore, pAscore);
end;